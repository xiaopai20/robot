<html>
<header>
<title>Robort</title>

<style>
body {
    background-color:#000000;
    text-align: center;
}
</style>

</header>
<script>

var speakerCommand = 'C:/Python27/python.exe C:/Users/Hannah/Desktop/xiaopai/src/speak.py';
var resultPage = "getPersonName";

var nameMap = {
  'xiaopai': 'xiao pai',
  'lixue': 'li xue',
  'room': 'nobody'
}

function speak(text) {
   w = new ActiveXObject("WScript.Shell");
   w.run(speakerCommand + " \"" + text + "\"", 0, true);
}

function getResult() {
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("GET", resultPage, true);
  xmlhttp.timeout = 1000;
  xmlhttp.send();
  return xmlhttp.responseText;
}

function addLog(text) {
    curLog = document.getElementById("log").innerHTML;
    document.getElementById("log").innerHTML = text + "<BR>" + curLog;
}

function run() {
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.open("GET", resultPage, true);
    xmlhttp.timeout = 3000;

    xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4) {
            if (this.status == 200)
                processResult(this.responseText);
            else if (this.status != 0)
                addLog("http response error");
        }
    };
    xmlhttp.ontimeout = function () {
        addLog("http request timeout");
        setTimeout(run, 100);
    }
    xmlhttp.send();
}

var previousResult = "";
function processResult(result) {
    addLog("process " + result);

    if (nameMap[result] == undefined) {
        setTimeout(run, 100);
        return;
    }
    if (result == previousResult) {
        setTimeout(run, 200);
        return;
    }
    var speakText = "";
    if (nameMap[result] != "nobody") {
        document.getElementById("robotImg").src="robotHello.png";
        speakText = "Hello " + nameMap[result];
    }
    else {
        document.getElementById("robotImg").src="robotStand.png";
        speakText = "Goodbye " + nameMap[previousResult];
    }
    document.getElementById("speak").innerText=speakText;
    speak(speakText);
    previousResult = result;
    setTimeout(run, 200);
}

alert("start");
</script>
<body onload="run()">
<br><br><br><br><br>
<div><font id="speak" size=22 color="#FFFFFF">Hello</font></div>
<br><br><br>
<img id="robotImg" src="robotStand.png" width=300/>

<br>
<font id="log" color="#888888"></font>
</body>
</html>